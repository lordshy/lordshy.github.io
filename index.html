<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–ª—è –ê–Ω–Ω—ã ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Comfortaa:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Error Handler: Show errors on screen instead of white screen -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            const loader = document.getElementById('loading');
            if(loader) loader.style.display = 'none';
            
            const div = document.createElement('div');
            div.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:white; color:red; z-index:9999; padding:20px; overflow:auto; font-family:monospace;';
            div.innerHTML = '<h3>–£–ø—Å! –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ :(</h3><p>' + msg + '</p><pre>' + (error ? error.stack : '') + '</pre>';
            document.body.appendChild(div);
            return false;
        };
    </script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              handwriting: ['Pacifico', 'cursive'],
              sans: ['Comfortaa', 'sans-serif'],
            },
            colors: {
              love: {
                50: '#fff1f2',
                100: '#ffe4e6',
                200: '#fecdd3',
                300: '#fda4af',
                400: '#fb7185',
                500: '#f43f5e',
                600: '#e11d48',
                700: '#be123c',
              }
            },
            animation: {
              'float': 'float 6s ease-in-out infinite',
            }
          }
        }
      }
    </script>
    <style>
        body { margin: 0; overflow-x: hidden; }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }
        
        #loading {
            position: fixed; inset: 0; display: flex; justify-content: center; align-items: center;
            background: #fff1f2; color: #e11d48; font-family: 'Comfortaa', sans-serif;
            font-size: 1.5rem; z-index: 50; transition: opacity 0.5s ease;
        }
    </style>
    
    <!-- Import Map -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "canvas-confetti": "https://esm.sh/canvas-confetti@1.9.2",
    "@google/genai": "https://esm.sh/@google/genai@^1.41.0"
  }
}
</script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-love-50 text-slate-800">
    <div id="root"></div>
    <div id="loading">–ó–∞–≥—Ä—É–∂–∞–µ–º –ª—é–±–æ–≤—å... ‚ù§Ô∏è</div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import confetti from 'canvas-confetti';

        // --- Floating Hearts Component ---
        const FloatingHearts = () => {
            const [hearts, setHearts] = useState([]);

            useEffect(() => {
                const newHearts = Array.from({ length: 20 }).map((_, i) => ({
                    id: i,
                    left: Math.random() * 100,
                    animationDuration: 6 + Math.random() * 10,
                    size: 10 + Math.random() * 20,
                    delay: Math.random() * 5,
                }));
                setHearts(newHearts);
            }, []);

            return (
                <div className="fixed inset-0 pointer-events-none z-0 overflow-hidden">
                    {hearts.map((heart) => (
                        <div
                            key={heart.id}
                            className="absolute bottom-[-50px] text-love-300 opacity-40 animate-float"
                            style={{
                                left: `${heart.left}%`,
                                fontSize: `${heart.size}px`,
                                animationDuration: `${heart.animationDuration}s`,
                                animationDelay: `${heart.delay}s`,
                                transform: `translateY(0) rotate(${Math.random() * 360}deg)`,
                            }}
                        >
                            ‚ù§Ô∏è
                        </div>
                    ))}
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [stage, setStage] = useState('ask');
            const [noCount, setNoCount] = useState(0);
            const [noButtonPosition, setNoButtonPosition] = useState(null);
            const [imgSrc, setImgSrc] = useState("https://i.imgur.com/6LCYRL9.png");

            // Hide loading screen when mounted
            useEffect(() => {
                const loader = document.getElementById('loading');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.remove(), 500);
                }
            }, []);

            const noPhrases = [
                "No", "–¢—ã —É–≤–µ—Ä–µ–Ω–∞?", "–¢—ã —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–∞?!", "–ü–æ–¥—É–º–∞–π –µ—â–µ —Ä–∞–∑!",
                "–ù–µ —Ä–∞–∑–±–∏–≤–∞–π –º–Ω–µ —Å–µ—Ä–¥—Ü–µ üíî", "–Ø –±—É–¥—É –ø–ª–∞–∫–∞—Ç—å...", "–ù—É –ø–æ–∂–∞–ª—É–π—Å—Ç–∞...",
                "–Ø —Å–¥–µ–ª–∞—é —Ç–µ–±–µ –º–∞—Å—Å–∞–∂!", "–Ø –∫—É–ø–ª—é —Ç–µ–±–µ —à–æ–∫–æ–ª–∞–¥–∫—É!",
                "–ù–£ –ü–û–ñ–ê–õ–£–ô–°–¢–ê üôè", "–£ —Ç–µ–±—è –Ω–µ—Ç –≤—ã–±–æ—Ä–∞! ‚ù§Ô∏è"
            ];

            const moveNoButton = () => {
                setNoCount(prev => prev + 1);
                if (noCount >= 2) {
                    const x = Math.random() * (window.innerWidth - 150);
                    const y = Math.random() * (window.innerHeight - 80);
                    setNoButtonPosition({ top: `${Math.max(20, y)}px`, left: `${Math.max(20, x)}px` });
                }
            };

            const handleYesClick = () => {
                setStage('success');
                const duration = 3000;
                const end = Date.now() + duration;

                // Safe confetti shape
                const heart = confetti.shapeFromPath ? confetti.shapeFromPath({
                    path: 'M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z'
                }) : 'circle';

                const frame = () => {
                    confetti({
                        particleCount: 2, angle: 60, spread: 55, origin: { x: 0 },
                        colors: ['#ff0000', '#ffa500', '#ff69b4', '#ffc0cb'],
                        shapes: [heart], scalar: 3, drift: 0,
                    });
                    confetti({
                        particleCount: 2, angle: 120, spread: 55, origin: { x: 1 },
                        colors: ['#ff0000', '#ffa500', '#ff69b4', '#ffc0cb'],
                        shapes: [heart], scalar: 3, drift: 0,
                    });
                    if (Date.now() < end) requestAnimationFrame(frame);
                };
                frame();
            };

            const getNoText = () => noPhrases[Math.min(noCount, noPhrases.length - 1)];

            return (
                <div className="min-h-screen relative font-sans flex flex-col items-center justify-center p-4 overflow-hidden bg-love-50">
                    <FloatingHearts />

                    {stage === 'ask' ? (
                        <div className="z-10 flex flex-col items-center gap-8 max-w-2xl w-full">
                            <div className="w-full flex justify-center mb-4">
                                <img 
                                    src={imgSrc}
                                    onError={() => setImgSrc("https://images.unsplash.com/photo-1518199227707-b21aaa6fb101?auto=format&fit=crop&w=600&q=80")}
                                    alt="Cute character" 
                                    className="rounded-2xl shadow-xl w-64 h-64 object-cover border-4 border-white bg-white"
                                />
                            </div>
                            
                            <h1 className="text-4xl md:text-6xl font-handwriting text-love-600 text-center drop-shadow-sm px-4">
                                Will you be my Valentine, Anna?
                            </h1>

                            <div className="flex flex-wrap items-center justify-center gap-4 mt-8 w-full relative h-32">
                                <button
                                    onClick={handleYesClick}
                                    className="bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl transition-all duration-200 shadow-lg transform hover:scale-110 z-20"
                                    style={{
                                        fontSize: `${Math.min(1.2 + noCount * 0.5, 3.5)}rem`,
                                        padding: `${Math.min(12 + noCount * 5, 50)}px ${Math.min(24 + noCount * 10, 100)}px`
                                    }}
                                >
                                    Yes
                                </button>

                                <button
                                    onClick={moveNoButton}
                                    className="bg-love-500 hover:bg-love-600 text-white font-bold py-3 px-6 rounded-xl transition-all duration-100 shadow-lg z-30"
                                    style={{
                                        position: noButtonPosition ? 'fixed' : 'static',
                                        top: noButtonPosition?.top,
                                        left: noButtonPosition?.left,
                                        whiteSpace: 'nowrap'
                                    }}
                                >
                                    {getNoText()}
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="z-10 flex flex-col items-center animate-in zoom-in duration-500 text-center">
                            <div className="mb-8">
                                <img 
                                    src="https://media.tenor.com/gUiu1zyxfzYAAAAi/bear-kiss-bear-kisses.gif" 
                                    alt="Bear kiss" 
                                    className="rounded-lg shadow-2xl w-64 h-64 object-cover mx-auto"
                                />
                            </div>
                            
                            <h1 className="text-4xl md:text-6xl font-handwriting text-love-600 mb-6 drop-shadow-md">
                                I Love You Anna! ‚ù§Ô∏è
                            </h1>
                            <p className="text-xl text-love-400 font-sans max-w-md mx-auto">
                                –£—Ä–∞! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –º–æ—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞!
                                (–Ø –∑–Ω–∞–ª, —á—Ç–æ —Ç—ã —Å–æ–≥–ª–∞—Å–∏—à—å—Å—è üòè)
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>